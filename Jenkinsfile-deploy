pipeline{
    environment {
        PROJECT_ID = 'rentler-370619'
        CLUSTER_NAME = 'rentler-cluster'
        LOCATION = 'us-central1'
        CREDENTIALS_ID = 'gcloud-creds'
    }
    parameters {
        choice(name: "SERVICE",
               choices: [
                    "account-service",
                    "apartment-service",
                    "notification-service",
                    "auth-service",
                    "api-gateway"
                    ],
               description: "service")
    }
    agent any
    stages {
        stage ('Deploy to GKE') {
            steps {
                withCredentials([file(credentialsId: 'gcloud-creds', variable: 'GOOGLE_APPLICATION_CREDENTIALS')]) {
                    withKubeConfig([credentialsId: 'jenkins-sa',
                                        caCertificate: 'LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVMRENDQXBTZ0F3SUJBZ0lRZHlEREpPazBTMEc3T3B5R2lncUhkekFOQmdrcWhraUc5dzBCQVFzRkFEQXYKTVMwd0t3WURWUVFERXlRM09XVmtNREJsT1MxaE1tUmlMVFEzWXpVdE9UQXdZaTB5WVdZd01qVXdZV1UyT0dFdwpJQmNOTWpJeE1qQTBNVGcxTXpBeFdoZ1BNakExTWpFeE1qWXhPVFV6TURGYU1DOHhMVEFyQmdOVkJBTVRKRGM1ClpXUXdNR1U1TFdFeVpHSXRORGRqTlMwNU1EQmlMVEpoWmpBeU5UQmhaVFk0WVRDQ0FhSXdEUVlKS29aSWh2Y04KQVFFQkJRQURnZ0dQQURDQ0FZb0NnZ0dCQUxCRnRGZUpIYlY0YzNUVWJKNnlYVW82Vi9WbEhGMjUyNkgyMWc4NwplU0huZndNM1JZbHIrMlhlbGVkaUlNTk1FdFJvaDBieVNOSUxVclhQQit4NlM1ckVQWkl5TGRpL2pQRDZ0K3Z5CnVIcUZpWGlqNnBNWUw3c1RNWE5kN3F1VTN6ZUJUV3N6SXRPNkNCL2lBRVROS0dWamZ4VWNGZkdvV1JxWTR0MkwKLzBPVTFSdVlnelRZY01qeWlhSHdCU0xpbHljMkVyelozSDhtcUJBRTdvcFV3dHdIM2RrMFppaDhMZHhXdUJOZApZL0tzS1BRN0hxb1VIcTRJSmpVZC9LSG9kTzJWRFR3L2h5R3U2MFBCRzduVnBKc3BTWFUzdkdqdVRFSVFBYWUrCm5Id29iczNsSXEzVVN4blB4czB6UXVSb3JmYzBtUG82SkRDZms2V1pPSC92RHRNWFZHZUFxS09OeUswOXJ4ZlIKYXNpbzE0U1NPVEFWZnN2QVpJbWQ1dDY1UERuUWFNVy9tekdRcXpHang3VXJsNWRBa3J4ODk2U1E0N1pTYzJtcQpoUndiU0VSQUNMTjZuREpid2RqOEF3Z1A0Q1B0NHNhZGdha003RnROV1NGTE94eTE3Z09MdjNHbCtiMTBhbnlOCnlreTdaVmZOMGdTcG1JeFlUb1VuMFV0K0V3SURBUUFCbzBJd1FEQU9CZ05WSFE4QkFmOEVCQU1DQWdRd0R3WUQKVlIwVEFRSC9CQVV3QXdFQi96QWRCZ05WSFE0RUZnUVUwckhtZVlEL2pNdEs5ZHBSTkhrbURZbGw2U2d3RFFZSgpLb1pJaHZjTkFRRUxCUUFEZ2dHQkFDNFYwR1l6RU1KWkNmRzF2Ukx0V1FWVDV1WHU2Zlg3SVJWSGg0OGpNdEdOCjh3M1ZveHhaSjE4TUJzOERnb1lQNUxIL2dlQVo0eEdNNVIycEsxeWpBRTViNDVPdGVnaWo3KzBLejhuWFh0c3gKVmx2N3pjaFhhYkFmd2VIcGw2M25HTno5WXFUa3pwd0FZdzVMTmFHREdDVWxZYnN5RUF3OTBybExXTGNhU2YvNgpPZ2tGeGZGZEpDdnIrMjRad3hHUGpCem1GbGUzN1dXRGkrNkVUNUFQTGpsemhPOVBZcFNTNEdWRnRFZXdTNkxnClM2UENRWW9pL0Y3QlJPY0hVeUptMXVOdk4yWlBkYUJSNVoyUVc5RFp4cGYwNnRHcWZpcW4vK1h1aHRxalFyd0MKeW82R0RSQ1Q0MGhQTkVWdC9JdjdpcWlxYlI4Q3Q0TVRBNXozSmZFZFNGTXRENXlkMjZQYkUwY0kzSnJ4NmN2QwoxRC9OR0VnNk40U0tQMm8wL2pVanJZN2lNYkhXRFJvSStYVFVYQ1VlRHNkZDJjbml3SG9aSldMU2lhR0dDMHBVCmZrN0tVRDZ6aENhZXVzZHpTcGZzd09WSFltbHBMekdCcUhMaDB2SjR5ZU1QSmZPbHE5RU4xVHE1VHhiT0hHQXYKZTZZdi9DV3pwejFtdzFyS1lsMFRUUT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K',
                                        serverUrl: 'https://34.133.51.237',
                                        contextName: 'gke_rentler-370619_us-central1_renter-cluster',
                                        clusterName: 'rentler-cluster',
                                        namespace: 'jenkins'
                                        ]) {
                        sh "kubectl get services"
                    }
                    kubeconfig(caCertificate: ', credentialsId: 'jenkins-sa', serverUrl: 'https://34.133.51.237') {
                        sh "kubectl get services"
                    }
                }
        		echo "Deployment Finished ..."
            }
        }
    }
}

