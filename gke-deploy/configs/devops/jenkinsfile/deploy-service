pipeline{
    parameters {
        choice(name: "service to deploy",
               choices: [
                    "account-service",
                    "apartment-service",
                    "notification-service",
                    "auth-service",
                    "api-gateway",
                    "web-client",
                    "postgres"
                    ],
               description: "service")
    }
    agent any
    stages {
        stage ('Deploy to GKE') {
            steps {
                withCredentials([file(credentialsId: 'gcloud-creds', variable: 'GOOGLE_APPLICATION_CREDENTIALS')]) {
                    withKubeConfig([credentialsId: 'jenkins-sa']) {
                        sh 'curl -LO "https://storage.googleapis.com/kubernetes-release/release/v1.20.5/bin/linux/amd64/kubectl"'
                        sh "chmod u+x ./kubectl"
                        echo "${params.SERVICE}"
                        sh "./kubectl apply -f gke-deploy/configs/kubernetes/${params.SERVICE}.yaml"
                    }
                }
        		echo "Deployment Finished ..."
            }
        }
    }
}

